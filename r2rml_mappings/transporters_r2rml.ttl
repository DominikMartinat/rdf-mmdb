@prefix obo: <http://purl.obolibrary.org/obo/>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix bao: <http://www.bioassayontology.org/bao#>.
@prefix rr: <http://www.w3.org/ns/r2rml#>.
@prefix mmdbvoc: <https://rdf.molmedb.upol.cz/vocabulary#>.
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix sio: <http://semanticscience.org/resource/> .
@prefix edam: <http://edamontology.org/> .
@prefix dcterms: <http://purl.org/dc/terms/> .

################################################
## transporter interaction cenral node
################################################
<Transportes#TriplesMap1>
  rr:logicalTable [ rr:sqlQuery """
    SELECT i.id, s.identifier, i.protein_id, i.publication_id, m.publication_id AS secondary_publication
      FROM interactions_active AS i, structures AS s, model_has_publications AS m
      WHERE i.structure_id = s.id AND m.model_id = i.dataset_id AND m.model_type = 'App\\Models\\Dataset'
  """] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/tra{id}" ;
    rr:class bao:BAO_0003008
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0090012 ;
    rr:objectMap [ rr:template "https://identifiers.org/molmedb/{identifier}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0090012 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/target{protein_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000209 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/measure_group_tra{id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate dcterms:source ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/reference/ref{secondary_publication}"  ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate dcterms:references ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/reference/ref{publication_id}" ]
  ] .

################################################
## transporter interaction measure group
################################################
<Transportes#TriplesMap2>
  rr:logicalTable [ rr:sqlQuery """
    SELECT i.id, s.identifier, i.protein_id, i.note,
      CASE WHEN i.km IS NULL THEN NULL ELSE i.id END Km_id,
      CASE WHEN i.ec50 IS NULL THEN NULL ELSE i.id END EC50_id,
      CASE WHEN i.ki IS NULL THEN NULL ELSE i.id END Ki_id,
      CASE WHEN i.ic50 IS NULL THEN NULL ELSE i.id END IC50_id 
      FROM interactions_active AS i, structures as s
      WHERE i.structure_id = s.id
  """ ] ;  
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/measure_group_tra{id}" ;
    rr:class bao:BAO_0000040 ;
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000208 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pKm_tra{Km_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000208 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pEC50_tra{EC50_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000208 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pKi_tra{Ki_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000208 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pIC50_tra{IC50_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0090012 ;
    rr:objectMap [ rr:template "https://identifiers.org/molmedb/{identifier}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0090012 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/target{protein_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000426 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/tra{id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate rdfs:comment ;
    rr:objectMap [ rr:column "note"; rr:datatype xsd:string ]
  ] .

################################################
## transporter proteins
################################################
<Transportes#TriplesMap3>
  rr:logicalTable [ rr:sqlQuery """
      SELECT DISTINCT p.id, p.uniprot_id, pi.value
        FROM proteins AS p, protein_identifiers AS pi
        WHERE p.id = pi.protein_id AND pi.type = 1 AND pi.state = 2
  """
  ] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/target{id}" ;
    rr:class bao:BAO_0000283
  ] ;
    rr:predicateObjectMap [
    rr:predicate  rdfs:label ;
    rr:objectMap [ rr:column "value"; rr:datatype xsd:string ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate  skos:exactMatch ;
    rr:objectMap [ rr:template "http://purl.uniprot.org/uniprot/{uniprot_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate  sio:SIO_000008 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/target{id}_UniProt" ]
  ] .

<Transportes#TriplesMap4>
  rr:logicalTable [ rr:sqlQuery "SELECT id, uniprot_id FROM proteins" ] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/target{id}_UniProt" ;
    rr:class edam:data_2291
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000300 ;
    rr:objectMap [ rr:column "uniprot_id"; rr:datatype xsd:string ]
  ] .

################################################
## transporter endpoints
################################################
# interaction category names are wrong in the database right now
# mapping will be made as intended assuming assignement will be fixed

#later categories reworked to be more persistent
<Transportes#TriplesMap5>
  rr:logicalTable [ rr:sqlQuery """
    SELECT id,
      CASE
        WHEN category_id = 512 THEN 'PositiveResult' 
        WHEN category_id = 513 THEN 'NegativeResult' 
        ELSE NULL END AS res,
      CASE WHEN ec50 IS NOT NULL THEN id ELSE NULL END AS ec50_id,
      CASE WHEN km IS NOT NULL THEN id ELSE NULL END AS km_id
      FROM interactions_active WHERE category_id IN (512,513)
  """] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_substrate_tra{id}" ;
    rr:class mmdbvoc:SubstrateBindingAssay ;
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000300 ;
    rr:objectMap [ rr:template "https://w3id.org/reproduceme#{res}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0095000 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pEC50_tra{ec50_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0095000 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pKm_tra{km_id}" ]
  ] .

<Transportes#TriplesMap6>
  rr:logicalTable [ rr:sqlQuery """
    SELECT id,
      CASE
        WHEN category_id = 514 THEN 'PositiveResult' 
        WHEN category_id = 515 THEN 'NegativeResult' 
        ELSE NULL END AS res,
      CASE WHEN ic50 IS NOT NULL THEN id ELSE NULL END AS ic50_id,
      CASE WHEN ki IS NOT NULL THEN id ELSE NULL END AS ki_id
      FROM interactions_active WHERE category_id IN (514,515)
  """] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_inhibitor_tra{id}" ;
    rr:class mmdbvoc:InhibitionAssay
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000300 ;
    rr:objectMap [ rr:template "https://w3id.org/reproduceme#{res}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0095000 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pIC50_tra{ec50_id}" ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0095000 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pKi_tra{km_id}" ]
  ] .

<Transportes#TriplesMap7>
  rr:logicalTable [ rr:sqlQuery """
    SELECT id, km, km_accuracy
      FROM interactions_active
      WHERE km IS NOT NULL
    """ ] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pKm_tra{id}" ;
    rr:class mmdbvoc:PKm ;
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000300 ;
    rr:objectMap [ rr:column "km"; rr:datatype xsd:float ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000221 ;
    rr:objectMap [ rr:constant obo:UO_0000062 ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate mmdbvoc:hasStDev ;
    rr:objectMap [rr:column "km_accuracy"; rr:datatype xsd:float  ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000559 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/measure_group_tra{id}" ]
  ].

<Transportes#TriplesMap8>
  rr:logicalTable [ rr:sqlQuery """
    SELECT id, ec50, ec50_accuracy
      FROM interactions_active
      WHERE ec50 IS NOT NULL
    """ ] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pEC50_tra{id}" ;
    rr:class bao:BAO_0002583
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000300 ;
    rr:objectMap [ rr:column "ec50"; rr:datatype xsd:float ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000221 ;
    rr:objectMap [ rr:constant obo:UO_0000062 ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate mmdbvoc:hasStDev ;
    rr:objectMap [rr:column "ec50_accuracy"; rr:datatype xsd:float  ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000559 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/measure_group_tra{id}" ]
  ] .

<Transportes#TriplesMap9>
  rr:logicalTable [ rr:sqlQuery """
    SELECT id, ki, ki_accuracy
      FROM interactions_active
      WHERE ki IS NOT NULL
    """ ] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pKi_tra{id}" ;
    rr:class bao:BAO_0190004
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000300 ;
    rr:objectMap [ rr:column "ki"; rr:datatype xsd:float ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000221 ;
    rr:objectMap [ rr:constant obo:UO_0000062 ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate mmdbvoc:hasStDev ;
    rr:objectMap [rr:column "ki_accuracy"; rr:datatype xsd:float  ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000559 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/measure_group_tra{id}" ]
  ] .

<Transportes#TriplesMap10>
  rr:logicalTable [ rr:sqlQuery """
    SELECT id, ic50, ic50_accuracy
      FROM interactions_active
      WHERE ic50 IS NOT NULL
    """ ] ;
  rr:subjectMap [
    rr:template "https://rdf.molmedb.upol.cz/transporter/endpoint_pIC50_tra{id}" ;
    rr:class bao:BAO_0000199
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000300 ;
    rr:objectMap [ rr:column "ic50"; rr:datatype xsd:float ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate sio:SIO_000221 ;
    rr:objectMap [ rr:constant obo:UO_0000062 ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate mmdbvoc:hasStDev ;
    rr:objectMap [rr:column "ic50_accuracy"; rr:datatype xsd:float  ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate bao:BAO_0000559 ;
    rr:objectMap [ rr:template "https://rdf.molmedb.upol.cz/transporter/measure_group_tra{id}" ]
  ] .